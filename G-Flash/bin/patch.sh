# brew fetch --force-bottle --arch all --os all libusb flashrom lsusb libftdi
# lipo bin_arm/lib/libusb-1.0.0.dylib bin_x86/lib/libusb-1.0.0.dylib -create -output bin_u2b/lib/libusb-1.0.0.dylib
# lipo bin_arm/lib/libftdi1.2.dylib bin_x86/lib/libftdi1.2.dylib -create -output bin_u2b/lib/libftdi1.2.dylib
# lipo bin_arm/flashrom bin_x86/flashrom -create -output bin_u2b/flashrom

libusb1="0.1.4"
libusb1=$( echo "$libusb1" | xxd -p | cut -c -10 )
libusb2="1.0.0"
libusb2=$( echo "$libusb2" | xxd -p | cut -c -10 )

ScriptPath="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )"

cd "$ScriptPath"

xxd -p flashrom | tr -d '\n' | sed -e "s/2f7573722f6c6f63616c2f6f70742f6c696266746469302f6c69622f6c6962667464692e312e64796c6962/6c69622f6c6962667464692e312e64796c6962000000000000000000000000000000000000000000000000/g" -e "s/2f7573722f6c6f63616c2f6f70742f6c69627573622d636f6d7061742f6c69622f6c69627573622d"$libusb1"2e64796c6962/6c69622f6c69627573622d"$libusb1"2e64796c69620000000000000000000000000000000000000000000000000000000000/g" -e "s/2f7573722f6c6f63616c2f6f70742f6c69627573622f6c69622f6c69627573622d"$libusb2"2e64796c6962/6c69622f6c69627573622d"$libusb2"2e64796c696200000000000000000000000000000000000000000000/g"| xxd -p -r > flashrom2

rm -f flashrom
mv flashrom2 flashrom
chmod +x flashrom

for a in lib/*
do
xxd -p "$a" | tr -d '\n' | sed -e "s/2f7573722f6c6f63616c2f6f70742f6c696266746469302f6c69622f6c6962667464692e312e64796c6962/6c69622f6c6962667464692e312e64796c6962000000000000000000000000000000000000000000000000/g" -e "s/2f7573722f6c6f63616c2f6f70742f6c69627573622d636f6d7061742f6c69622f6c69627573622d"$libusb1"2e64796c6962/6c69622f6c69627573622d"$libusb1"2e64796c69620000000000000000000000000000000000000000000000000000000000/g" -e "s/2f7573722f6c6f63616c2f6f70742f6c69627573622f6c69622f6c69627573622d"$libusb2"2e64796c6962/6c69622f6c69627573622d"$libusb2"2e64796c696200000000000000000000000000000000000000000000/g"| xxd -p -r > "$a"2

rm -f "$a"
mv "$a"2 "$a"
done


